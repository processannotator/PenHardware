<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="render-view">
	
	<template>
		<style>
			:host {
				margin: 0;
			}
			
			:host:hover {
			}
			
			canvas {
				width: 100%;
				height: 100%;
			}
			
		</style>

	</template>

	<script>
		var glScene = new THREE.Scene()
		var cssScene = new THREE.Scene()
		var camera
		var controls
		var cssObject
		var glRenderer
		var cube
		var cssRenderer = new THREE.CSS3DRenderer()

		var render
		var animate
		

	
	
		Polymer({
			is: "render-view",
      properties: {
        model: Object,
				annotations: {
					type: Array
					observer: "renderAnnotations"
				}
      },
			ready: function() {
				animate = function () {
					requestAnimationFrame( animate )
					controls.update()
					cssObject.lookAt(camera.position)
					// render()
				}
				
				render = function() {
					// triggered on controls.update() and resize()
					
					glRenderer.render( glScene, camera )
					cssRenderer.render( cssScene, camera )
				}

  			
			},
			attached: function () {
				let width = this.parentNode.getBoundingClientRect().width
				let height = this.parentNode.getBoundingClientRect().height
				
				camera = new THREE.PerspectiveCamera( 75, width / height, 0.05, width )
				camera.position.set(400,400,400)
				glRenderer = new THREE.WebGLRenderer( { antialias: false, alpha:true } )
				glRenderer.setClearColor(0x00ff00, 0.0)
				// glRenderer.setClearColor( 0xeeeeee );
				glRenderer.setSize(width, height)
				cssRenderer.setSize( width, height )
				cssRenderer.domElement.style.position = 'absolute';
				cssRenderer.domElement.style.top = 0;


				
				controls = new THREE.TrackballControls( camera, cssRenderer.domElement )

				controls.rotateSpeed = 1.0
				controls.zoomSpeed = 1.2
				controls.panSpeed = 0.8
				
				controls.noZoom = false
				controls.noPan = false
				
				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3
				controls.keys = [ 65, 83, 68 ]
				
				var geometry = new THREE.BoxGeometry( 100, 100, 100 )
				var material = new THREE.MeshNormalMaterial( { color: 0x00ff00 } )
				cube = new THREE.Mesh( geometry, material )
				cube.rotation.y = 1
				glScene.add( cube )
				
				blubb = document.createElement( 'div' )
				blubb.style.opacity = 1.0
				blubb.style.fontSize = "20px"
				blubb.style.background = "rgba(200, 200, 200, 0.5)"
				blubb.textContent = "this is an annotation."
				cssObject = new THREE.CSS3DSprite( blubb )
				cssScene.add( cssObject )

				Polymer.dom(this.root).appendChild(glRenderer.domElement)
				Polymer.dom(this.root).appendChild(cssRenderer.domElement)
				controls.addEventListener( 'change', render )
				controls.handleResize()
				render()
				animate()
			},
			resize: function (event) {
				let width = this.parentNode.getBoundingClientRect().width
				let height = this.parentNode.getBoundingClientRect().height
				glRenderer.setSize(width, height)
				camera.aspect = width / height
				camera.updateProjectionMatrix()
				controls.handleResize()
				render()
			},
			renderAnnotations: function () {
				console.log('render annotations')
			}

		})
    
    
    
	</script>

</dom-module>